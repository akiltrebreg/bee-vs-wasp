# Bee vs Wasp Classification

Проект по автоматической классификации изображений насекомых на четыре категории
с использованием глубокого обучения.

## Постановка задачи

**Цель проекта**: разработать и обучить модель компьютерного зрения, способную
автоматически классифицировать изображения насекомых на четыре категории: пчела,
оса, другое насекомое, прочее.

Такое решение помогает уменьшить время ручной сортировки изображений и повысить
точность классификации при работе с полевыми или любительскими фотографиями.

За основу проекта взят
[ноутбук с Kaggle](https://www.kaggle.com/code/erntkn/pytorch-starter-with-resnet18).

## Формат входных и выходных данных

### Входные данные

- **Формат**: RGB-изображение
- **Размер**: любое входное изображение приводится к 224×224
- **Нормализация**:
  - `mean = (0.485, 0.456, 0.406)`
  - `std = (0.229, 0.224, 0.225)`
- **Аугментации** (во время обучения):
  - `RandomResizedCrop(224)`
  - `RandomHorizontalFlip()`

### Выходные данные

- **Формат**: Вектор логитов
- **Классы**: После `argmax` модель возвращает целое число {0, 1, 2, 3}

| Число | Класс       |
| ----- | ----------- |
| 0     | bee         |
| 1     | wasp        |
| 2     | otherinsect |
| 3     | other       |

## Метрики

- **Accuracy**: Вектор логитов
- **F1-score (macro)**: После `argmax` модель возвращает целое число {0, 1, 2,
  3}

## Датасет

Используется датасет
[Bees vs Wasps](https://www.kaggle.com/datasets/jerzydziewierz/bee-vs-wasp) с
Kaggle.

### Статистика

| Категория   | Количество изображений |
| ----------- | ---------------------- |
| bee         | 3 183                  |
| wasp        | 4 943                  |
| otherinsect | 2 453                  |
| other       | 845                    |
| **Всего**   | **12 424**             |

### Разбиение на выборки

| Тип выборки            | Количество изображений |
| ---------------------- | ---------------------- |
| Training               | 7 942                  |
| Validation (1st-level) | 1 719                  |
| Final validation       | 1 763                  |

Разбиение задано явно в `labels.csv` через флаги `is_validation` и
`is_final_validation`.

### Потенциальные проблемы

- **Смещенные данные**: Большинство пчел сфотографированы на цветке, большинство
  ос - без цветков
- **Несбалансированность**: Класс `other` в несколько раз меньше остальных,
  класс `wasp` на 1 760 изображений больше чем `bee`

## Архитектура

### Бейзлайн

- **SimpleCNN**: Простая сверточная нейросеть с 4 блоками (Conv + ReLU +
  BatchNorm + MaxPool)

### Основная модель

- **ResNet18**: Предобученная на ImageNet модель из torchvision
- **Fine-tuning**: Замена финального fully-connected слоя на 4-классовый
  классификатор

### Гиперпараметры обучения

- **Оптимизатор**: SGD
  - Learning rate: 0.001
  - Momentum: 0.9
- **Loss**: CrossEntropyLoss
- **Эпохи**: 15
- **Batch size**: 32
- **Фреймворк**: PyTorch Lightning

## Технический стек

- **Управление зависимостями**: uv
- **Обучение**: PyTorch Lightning
- **Логирование**: MLflow
- **Управление данными**: DVC
- **Конфигурация**: Hydra
- **CLI**: Fire
- **Качество кода**: Ruff + pre-commit

---

## Setup

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd bee-vs-wasp
```

### 2. Установка uv

#### macOS / Linux

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Windows

```bash
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

#### Альтернативно через pip

```bash
pip install uv
```

### 3. Установка зависимостей

Создание виртуального окружения и установка всех зависимостей:

```bash
uv sync
```

### 4. Настройка pre-commit хуков

#### Установка pre-commit хуков

```bash
uv run pre-commit install
```

#### Проверка (опционально)

```bash
uv run pre-commit run --all-files
```
